# Budget API

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ REST API –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Telegram.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ (checking, savings, cash, credit, investment)
- üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
- üí∏ –£—á–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–¥–æ—Ö–æ–¥—ã, —Ä–∞—Å—Ö–æ–¥—ã, –ø–µ—Ä–µ–≤–æ–¥—ã)
- üìà –ë—é–¥–∂–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
- üìâ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã
- üîí JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∑–∞—â–∏—Ç—ã API

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.24.4 –∏–ª–∏ –≤—ã—à–µ
- SQLite
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/pinghoyk/budget-api.git
cd budget-api
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
go mod download
```

3. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –∏–∑ –ø—Ä–∏–º–µ—Ä–∞:
```bash
cp .env.example .env
```

4. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   - `JWT_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
   - `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞
   - `DB_PATH` - –ø—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `data/budget.db`)
   - `PORT` - –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `8080`)

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```bash
go run cmd/api/main.go
```

## API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### `POST /api/auth/telegram`
–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram.

**Request Body:**
```json
{
  "id": 123456789,
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ò–≤–∞–Ω–æ–≤",
  "username": "ivan_ivanov",
  "photo_url": "https://...",
  "auth_date": 1234567890,
  "hash": "abcdef..."
}
```

**Response:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "telegram_id": 123456789,
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    ...
  }
}
```

#### `GET /api/auth/me`
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è).

**Headers:**
```
Authorization: Bearer <token>
```

### –°—á–µ—Ç–∞ (Accounts)

#### `GET /api/accounts`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### `POST /api/accounts`
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç.

**Request Body:**
```json
{
  "name": "–û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–∞",
  "type": "checking",
  "currency": "RUB",
  "initial_balance": 10000.0,
  "color": "#FF5733",
  "icon": "üí≥"
}
```

#### `GET /api/accounts/{id}`
–ü–æ–ª—É—á–∏—Ç—å —Å—á–µ—Ç –ø–æ ID.

#### `PUT /api/accounts/{id}`
–û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç.

#### `DELETE /api/accounts/{id}`
–£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç.

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (Categories)

#### `GET /api/categories`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π query –ø–∞—Ä–∞–º–µ—Ç—Ä: `type` (income/expense).

#### `POST /api/categories`
–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é.

**Request Body:**
```json
{
  "name": "–ü—Ä–æ–¥—É–∫—Ç—ã",
  "type": "expense",
  "color": "#4CAF50",
  "icon": "üõí",
  "parent_id": null
}
```

#### `GET /api/categories/{id}`
–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ ID.

#### `PUT /api/categories/{id}`
–û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é.

#### `DELETE /api/categories/{id}`
–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é.

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Transactions)

#### `GET /api/transactions`
–ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

**Query Parameters:**
- `account_id` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—á–µ—Ç—É
- `category_id` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `type` - —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (income/expense/transfer)
- `start_date` - –Ω–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)
- `end_date` - –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)
- `limit` - –ª–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50)
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

#### `POST /api/transactions`
–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

**Request Body (—Ä–∞—Å—Ö–æ–¥):**
```json
{
  "account_id": 1,
  "category_id": 2,
  "type": "expense",
  "amount": 500.0,
  "currency": "RUB",
  "description": "–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤",
  "transaction_date": "2024-01-15T10:30:00Z",
  "notes": "–ú–∞–≥–∞–∑–∏–Ω —É –¥–æ–º–∞"
}
```

**Request Body (–ø–µ—Ä–µ–≤–æ–¥):**
```json
{
  "account_id": 1,
  "type": "transfer",
  "amount": 1000.0,
  "currency": "RUB",
  "to_account_id": 2,
  "transaction_date": "2024-01-15T10:30:00Z"
}
```

#### `GET /api/transactions/{id}`
–ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø–æ ID.

#### `PUT /api/transactions/{id}`
–û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

#### `DELETE /api/transactions/{id}`
–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è).

### –ë—é–¥–∂–µ—Ç—ã (Budgets)

#### `GET /api/budgets`
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±—é–¥–∂–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### `POST /api/budgets`
–°–æ–∑–¥–∞—Ç—å –±—é–¥–∂–µ—Ç.

**Request Body:**
```json
{
  "category_id": 2,
  "amount": 15000.0,
  "period": "monthly",
  "start_date": "2024-01-01",
  "end_date": "2024-12-31"
}
```

#### `GET /api/budgets/{id}`
–ü–æ–ª—É—á–∏—Ç—å –±—é–¥–∂–µ—Ç –ø–æ ID.

#### `GET /api/budgets/{id}/status`
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±—é–¥–∂–µ—Ç–∞ (–ø–æ—Ç—Ä–∞—á–µ–Ω–æ, –æ—Å—Ç–∞–ª–æ—Å—å, –ø—Ä–æ—Ü–µ–Ω—Ç).

**Response:**
```json
{
  "budget": { ... },
  "spent": 8500.0,
  "remaining": 6500.0,
  "percentage": 56.67,
  "is_exceeded": false
}
```

#### `PUT /api/budgets/{id}`
–û–±–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç.

#### `DELETE /api/budgets/{id}`
–£–¥–∞–ª–∏—Ç—å –±—é–¥–∂–µ—Ç.

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (Statistics)

#### `GET /api/stats/category-summary`
–ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.

**Query Parameters:**
- `start_date` - –Ω–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)
- `end_date` - –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)

**Response:**
```json
[
  {
    "category_id": 2,
    "category_name": "–ü—Ä–æ–¥—É–∫—Ç—ã",
    "type": "expense",
    "total_amount": 12500.0,
    "count": 45
  }
]
```

#### `GET /api/stats/monthly-balance`
–ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–µ—Å—è—á–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤.

**Query Parameters:**
- `start_date` - –Ω–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)
- `end_date` - –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (YYYY-MM-DD)

**Response:**
```json
[
  {
    "month": "2024-01",
    "income": 50000.0,
    "expense": 35000.0,
    "balance": 15000.0
  }
]
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

- **users** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ Telegram
- **accounts** - —Å—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **categories** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
- **transactions** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–¥–æ—Ö–æ–¥—ã, —Ä–∞—Å—Ö–æ–¥—ã, –ø–µ—Ä–µ–≤–æ–¥—ã)
- **budgets** - –±—é–¥–∂–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`
- Telegram –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ HMAC-SHA256
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–±–æ—Ä–∫–∞

```bash
go build -o budget-api cmd/api/main.go
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
go test ./...
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT